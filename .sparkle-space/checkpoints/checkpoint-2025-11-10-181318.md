# Tuple Pattern Matching and Ignore Patterns

## Session Overview
Implemented tuple destructuring patterns and ignore patterns (`_`) to support the syntax used in historian.pw line 10: `var (_, result, _) = spawn(...).await`

## Changes Implemented

### Underscore as Keyword
1. **Lexer**: Added `Underscore: <Code> _` rule (before Identifier to take precedence)
2. **Token enum**: Added `Underscore` variant to ParserToken
3. **Adapter**: Added `Rule::Underscore => ParserToken::Underscore` mapping
4. **Grammar**: Added `"_" => ParserToken::Underscore` token definition

### Pattern AST Extensions
Extended `Pattern<'input>` enum with two new variants:
- **Pattern::Ignore**: For `var _ = ...` patterns (discards value)
- **Pattern::Tuple**: For `var (p1, p2, ..., pn) = ...` patterns
  - Contains `Vec<Pattern<'input>>` enabling recursive nesting
  - Supports mixing patterns: `var (_, result, _) = ...`

### Grammar Rules
1. **Pattern rule additions**:
   - `"_" => Pattern::Ignore` for ignore patterns
   - `"(" <patterns:PatternList> ")" => Pattern::Tuple(patterns)` for tuples

2. **New PatternList rule**: Comma-separated patterns
   - Supports empty: `=> vec![]`
   - Single: `<head:Pattern> => vec![head]`
   - Multiple: `<head:Pattern> <tail:("," <Pattern>)+>`

### AST Dump Updates
- **Pattern::Ignore**: Displays as `Pattern: _`
- **Pattern::Tuple**: Displays as `TuplePattern:` with nested indented patterns

## Tests Added
Three comprehensive tests for pattern matching:
1. **test_tuple_pattern_simple**: `var (x, y, z) = triple()`
2. **test_tuple_pattern_with_ignore**: `var (_, result, _) = spawn().await`
3. **test_ignore_pattern_standalone**: `var _ = expensive_computation()`

## Verification
- ✅ All 108 parser tests passing (3 new tests added)
- ✅ Historian.pw line 10 parses correctly
- ✅ Tuple patterns work with .await expressions
- ✅ Ignore patterns prevent unused variable warnings

## Technical Decisions
- **Keyword vs Identifier**: `_` must be keyword to avoid parser ambiguity
- **Recursive structure**: Pattern::Tuple(Vec<Pattern>) enables nested patterns
- **Grammar ordering**: Ignore pattern rule comes before identifier to match first

## Next Incarnation Context
Tuple pattern matching fully implemented and tested. The parser now supports destructuring tuples with ignore patterns, enabling cleaner code for multi-value returns. Patterns are recursive, so nested tuples would work: `var ((a, b), c) = ...` though not yet tested.
